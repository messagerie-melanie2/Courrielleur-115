<?xml version="1.0"?>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, you can obtain one at http://mozilla.org/MPL/2.0/. -->


<!DOCTYPE html [
<!ENTITY % msgHdrViewOverlayDTD SYSTEM "chrome://messenger/locale/msgHdrViewOverlay.dtd">
%msgHdrViewOverlayDTD;
<!ENTITY % messengerDTD SYSTEM "chrome://messenger/locale/messenger.dtd" >
%messengerDTD;
<!ENTITY % editContactOverlayDTD SYSTEM "chrome://messenger/locale/editContactOverlay.dtd">
%editContactOverlayDTD;
<!ENTITY % lightningDTD SYSTEM "chrome://lightning/locale/lightning.dtd">
%lightningDTD;
<!ENTITY % calendarDTD SYSTEM "chrome://calendar/locale/calendar.dtd" >
%calendarDTD;
<!ENTITY % smimeDTD SYSTEM "chrome://messenger-smime/locale/msgReadSecurityInfo.dtd">
%smimeDTD;
]>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
      xmlns:html="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <title></title>

  <link rel="icon" href="chrome://messenger/skin/icons/new/compact/draft.svg" />

  <link rel="stylesheet" href="chrome://calendar/skin/calendar.css" />
  <link rel="stylesheet" href="chrome://calendar/skin/shared/calendar-invitation-display.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/messageWindow.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/popupPanel.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/messageHeader.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/icons.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/colors.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/folderMenus.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/attachmentList.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/searchBox.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/openpgp/inlineNotification.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/contextMenu.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/autocomplete.css" />

  <link rel="localization" href="messenger/messenger.ftl" />
  <link rel="localization" href="toolkit/main-window/findbar.ftl" />
  <link rel="localization" href="toolkit/global/textActions.ftl" />
  <link rel="localization" href="calendar/calendar-invitation-panel.ftl" />
  <link rel="localization" href="messenger/openpgp/openpgp.ftl" />
  <link rel="localization" href="messenger/openpgp/openpgp-frontend.ftl" />
  <link rel="localization" href="messenger/openpgp/msgReadStatus.ftl" />
  <link rel="localization" href="messenger/messageheader/headerFields.ftl" />

  <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
  <script defer="defer" src="chrome://global/content/contentAreaUtils.js"></script>
  <script defer="defer" src="chrome://communicator/content/utilityOverlay.js"></script>
  <script defer="defer" src="chrome://communicator/content/contentAreaClick.js"></script>
  <script defer="defer" src="chrome://messenger/content/msgViewNavigation.js"></script>
  <script defer="defer" src="chrome://messenger/content/editContactPanel.js"></script>
  <script defer="defer" src="chrome://messenger/content/header-fields.js"></script>
  <script defer="defer" src="chrome://messenger/content/mail-offline.js"></script>
  <script defer="defer" src="chrome://messenger-smime/content/msgHdrViewSMIMEOverlay.js"></script>
  <script defer="defer" src="chrome://messenger-smime/content/msgReadSMIMEOverlay.js"></script>
  <script defer="defer" src="chrome://openpgp/content/ui/enigmailMessengerOverlay.js"></script>
  <script defer="defer" src="chrome://openpgp/content/ui/enigmailMsgHdrViewOverlay.js"></script>
  <script defer="defer" src="chrome://messenger/content/msgSecurityPane.js"></script>
  <script defer="defer" src="chrome://messenger-newsblog/content/newsblogOverlay.js"></script>
  <script defer="defer" src="chrome://messenger/content/messenger-customization.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-item-editing.js"></script>
  <script defer="defer" src="chrome://calendar/content/imip-bar.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-invitation-display.js"></script>
  <script defer="defer" src="chrome://calendar/content/widgets/calendar-invitation-panel.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailCore.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailContext.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailCommon.js"></script>
  <script defer="defer" src="chrome://messenger/content/msgHdrView.js"></script>
  <script defer="defer" src="chrome://messenger/content/aboutMessage.js"></script>
</head>
<html:body xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

  <stringbundle id="bundle_brand" src="chrome://branding/locale/brand.properties"/>
  <stringbundle id="bundle_messenger" src="chrome://messenger/locale/messenger.properties"/>

  <commandset id="attachmentCommands">
    <command id="cmd_openAllAttachments"
             oncommand="goDoCommand('cmd_openAllAttachments');"/>
    <command id="cmd_saveAllAttachments"
             oncommand="goDoCommand('cmd_saveAllAttachments');"/>
    <command id="cmd_detachAllAttachments"
             oncommand="goDoCommand('cmd_detachAllAttachments');"/>
    <command id="cmd_deleteAllAttachments"
             oncommand="goDoCommand('cmd_deleteAllAttachments');"/>
  </commandset>

  <popupset id="mainPopupSet">

  <menupopup id="mailContext" needsgutter="true">
    <!-- Links -->
    <menuitem id="mailContext-openInBrowser"
              class="menuitem-iconic"
              label="&openInBrowser.label;"
              accesskey="&openInBrowser.accesskey;"/>
    <menuitem id="mailContext-openLinkInBrowser"
              class="menuitem-iconic"
              label="&openLinkInBrowser.label;"
              accesskey="&openLinkInBrowser.accesskey;"/>
    <menuitem id="mailContext-copylink"
              class="menuitem-iconic"
              label="&copyLinkCmd.label;"
              accesskey="&copyLinkCmd.accesskey;"/>
    <menuitem id="mailContext-savelink"
              class="menuitem-iconic"
              label="&saveLinkAsCmd.label;"
              accesskey="&saveLinkAsCmd.accesskey;"/>
    <menuitem id="mailContext-reportPhishingURL"
              class="menuitem-iconic"
              label="&reportPhishingURL.label;"
              accesskey="&reportPhishingURL.accesskey;"/>
    <menuitem id="mailContext-addemail"
              class="menuitem-iconic"
              label="&AddToAddressBook.label;"
              accesskey="&AddToAddressBook.accesskey;"/>
    <menuitem id="mailContext-composeemailto"
              class="menuitem-iconic"
              label="&SendMessageTo.label;"
              accesskey="&SendMessageTo.accesskey;"/>
    <menuitem id="mailContext-copyemail"
              class="menuitem-iconic"
              label="&copyEmailCmd.label;"
              accesskey="&copyEmailCmd.accesskey;"/>
    <menuseparator/>

    <!-- Images -->
    <menuitem id="mailContext-copyimage"
              class="menuitem-iconic"
              label="&copyImageAllCmd.label;"
              accesskey="&copyImageAllCmd.accesskey;"/>
    <menuitem id="mailContext-saveimage"
              class="menuitem-iconic"
              label="&saveImageAsCmd.label;"
              accesskey="&saveImageAsCmd.accesskey;"/>
    <menuseparator/>

    <!-- Edit -->
    <menuitem id="mailContext-copy"
              class="menuitem-iconic"
              data-l10n-id="text-action-copy"/>
    <menuitem id="mailContext-selectall"
              class="menuitem-iconic"
              data-l10n-id="text-action-select-all"/>
    <menuseparator/>

    <!-- Search -->
    <menuitem id="mailContext-searchTheWeb"
              class="menuitem-iconic"/>
    <menuseparator/>

    <!-- Drafts/templates -->
    <menuitem id="mailContext-editDraftMsg"
              class="menuitem-iconic"
              label="&contextEditDraftMsg.label;"
              default="true"/>
    <menuitem id="mailContext-newMsgFromTemplate"
              class="menuitem-iconic"
              label="&contextNewMsgFromTemplate.label;"
              default="true"/>
    <menuitem id="mailContext-editTemplateMsg"
              class="menuitem-iconic"
              label="&contextEditTemplate.label;"
              accesskey="&contextEditTemplate.accesskey;"/>
    <menuseparator/>

    <!-- Open messages -->
    <menuitem id="mailContext-openNewTab"
              class="menuitem-iconic"
              label="&contextOpenNewTab.label;"
              accesskey="&contextOpenNewTab.accesskey;"/>
    <menuitem id="mailContext-openNewWindow"
              class="menuitem-iconic"
              label="&contextOpenNewWindow.label;"
              accesskey="&contextOpenNewWindow.accesskey;"/>
    <menuitem id="mailContext-openConversation"
              class="menuitem-iconic"
              label="&contextOpenConversation.label;"
              accesskey="&contextOpenConversation.accesskey;"/>
    <menuitem id="mailContext-openContainingFolder"
              class="menuitem-iconic"
              label="&contextOpenContainingFolder.label;"
              accesskey="&contextOpenContainingFolder.accesskey;"/>
    <menuseparator/>

    <!-- Reply/forward/redirect -->
    <menuitem id="mailContext-replyNewsgroup"
              class="menuitem-iconic"
              label="&contextReplyNewsgroup2.label;"
              accesskey="&contextReplyNewsgroup2.accesskey;"/>
    <menuitem id="mailContext-replySender"
              class="menuitem-iconic"
              label="&contextReplySender.label;"
              accesskey="&contextReplySender.accesskey;"/>
    <menuitem id="mailContext-replyAll"
              class="menuitem-iconic"
              label="&contextReplyAll.label;"
              accesskey="&contextReplyAll.accesskey;"/>
    <menuitem id="mailContext-replyList"
              class="menuitem-iconic"
              label="&contextReplyList.label;"
              accesskey="&contextReplyList.accesskey;"/>
    <menuitem id="mailContext-forward"
              class="menuitem-iconic"
              label="&contextForward.label;"
              accesskey="&contextForward.accesskey;"/>
    <menu id="mailContext-forwardAsMenu"
          class="menu-iconic"
          label="&contextForwardAsMenu.label;"
          accesskey="&contextForwardAsMenu.accesskey;">
      <menupopup id="mailContext-forwardAsPopup">
        <menuitem id="mailContext-forwardAsInline"
                  label="&contextForwardAsInline.label;"
                  accesskey="&contextForwardAsInline.accesskey;"/>
        <menuitem id="mailContext-forwardAsAttachment"
                  label="&contextForwardAsAttachmentItem.label;"
                  accesskey="&contextForwardAsAttachmentItem.accesskey;"/>
      </menupopup>
    </menu>

    <menuitem id="mailContext-multiForwardAsAttachment"
              class="menuitem-iconic"
              label="&contextMultiForwardAsAttachment.label;"
              accesskey="&contextMultiForwardAsAttachment.accesskey;"/>
    <menuitem id="mailContext-redirect"
              class="menuitem-iconic"
              data-l10n-id="context-menu-redirect-msg"/>
    <menuitem id="mailContext-editAsNew"
              class="menuitem-iconic"
              label="&contextEditMsgAsNew.label;"
              accesskey="&contextEditMsgAsNew.accesskey;"/>
    <menuseparator/>

    <!-- Tags/mark sub-menus -->
    <menu id="mailContext-tags"
          class="menu-iconic"
          label="&tagMenu.label;"
          accesskey="&tagMenu.accesskey;">
      <menupopup id="mailContext-tagpopup" needsgutter="true">
        <menuitem id="mailContext-addNewTag"
                  class="menuitem-iconic"
                  label="&addNewTag.label;"
                  accesskey="&addNewTag.accesskey;"/>
        <menuitem id="mailContext-manageTags"
                  class="menuitem-iconic"
                  label="&manageTags.label;"
                  accesskey="&manageTags.accesskey;"/>
        <menuseparator/>
        <menuitem id="mailContext-tagRemoveAll"
                  class="menuitem-iconic"
                  accesskey="&tagCmd0.key;"/>
        <menuseparator/>
      </menupopup>
    </menu>
    <menu id="mailContext-mark"
          class="menu-iconic"
          label="&markMenu.label;"
          accesskey="&markMenu.accesskey;">
      <menupopup id="mailContext-markPopup">
        <menuitem id="mailContext-markRead"
                  class="menuitem-iconic"
                  label="&markAsReadCmd.label;"
                  accesskey="&markAsReadCmd.accesskey;"/>
        <menuitem id="mailContext-markUnread"
                  class="menuitem-iconic"
                  label="&markAsUnreadCmd.label;"
                  accesskey="&markAsUnreadCmd.accesskey;"/>
        <menuitem id="mailContext-markThreadAsRead"
                  class="menuitem-iconic"
                  label="&markThreadAsReadCmd.label;"
                  accesskey="&markThreadAsReadCmd.accesskey;"/>
        <menuitem id="mailContext-markReadByDate"
                  class="menuitem-iconic"
                  label="&markReadByDateCmd.label;"
                  accesskey="&markReadByDateCmd.accesskey;"/>
        <menuitem id="mailContext-markAllRead"
                  class="menuitem-iconic"
                  label="&markAllReadCmd.label;"
                  accesskey="&markAllReadCmd.accesskey;"/>
        <menuseparator/>
        <menuitem id="mailContext-markFlagged"
                  type="checkbox"
                  label="&markStarredCmd.label;"
                  accesskey="&markStarredCmd.accesskey;"/>
        <menuseparator/>
        <menuitem id="mailContext-markAsJunk"
                  class="menuitem-iconic"
                  label="&markAsJunkCmd.label;"
                  accesskey="&markAsJunkCmd.accesskey;"/>
        <menuitem id="mailContext-markAsNotJunk"
                  class="menuitem-iconic"
                  label="&markAsNotJunkCmd.label;"
                  accesskey="&markAsNotJunkCmd.accesskey;"/>
        <menuitem id="mailContext-recalculateJunkScore"
                  class="menuitem-iconic"
                  label="&recalculateJunkScoreCmd.label;"
                  accesskey="&recalculateJunkScoreCmd.accesskey;"/>
      </menupopup>
    </menu>
    <menuseparator/>

    <!-- Move/copy/archive/convert/delete -->
    <menuitem id="mailContext-copyMessageUrl"
              class="menuitem-iconic"
              label="&copyMessageLocation.label;"
              accesskey="&copyMessageLocation.accesskey;"/>
    <menuitem id="mailContext-archive"
              class="menuitem-iconic"
              label="&contextArchive.label;"
              accesskey="&contextArchive.accesskey;"/>
    <menu id="mailContext-moveMenu"
          class="menu-iconic"
          label="&contextMoveMsgMenu.label;"
          accesskey="&contextMoveMsgMenu.accesskey;">
      <menupopup is="folder-menupopup" id="mailContext-fileHereMenu"
                 mode="filing"
                 showFileHereLabel="true"
                 showRecent="true"
                 recentLabel="&contextMoveCopyMsgRecentMenu.label;"
                 recentAccessKey="&contextMoveCopyMsgRecentMenu.accesskey;"
                 showFavorites="true"
                 favoritesLabel="&contextMoveCopyMsgFavoritesMenu.label;"
                 favoritesAccessKey="&contextMoveCopyMsgFavoritesMenu.accesskey;"/>
    </menu>
    <menu id="mailContext-copyMenu"
          class="menu-iconic"
          label="&contextCopyMsgMenu.label;"
          accesskey="&contextCopyMsgMenu.accesskey;">
      <menupopup is="folder-menupopup" id="mailContext-copyHereMenu"
                 mode="filing"
                 showFileHereLabel="true"
                 showRecent="true"
                 recentLabel="&contextMoveCopyMsgRecentMenu.label;"
                 recentAccessKey="&contextMoveCopyMsgRecentMenu.accesskey;"
                 showFavorites="true"
                 favoritesLabel="&contextMoveCopyMsgFavoritesMenu.label;"
                 favoritesAccessKey="&contextMoveCopyMsgFavoritesMenu.accesskey;"/>
    </menu>
    <menuitem id="mailContext-moveToFolderAgain"
              class="menuitem-iconic"
              label="&moveToFolderAgain.label;"
              accesskey="&moveToFolderAgain.accesskey;"/>

    <menu id="mailContext-decryptToFolder"
          class="menu-iconic"
          data-l10n-id="context-menu-decrypt-to-folder2"
          data-l10n-attrs="accesskey">
      <menupopup is="folder-menupopup"
                 id="mailContext-decryptToTargetFolder"
                 mode="filing"
                 showFileHereLabel="true"
                 showRecent="true"
                 recentLabel="&contextMoveCopyMsgRecentMenu.label;"
                 recentAccessKey="&contextMoveCopyMsgRecentMenu.accesskey;"
                 showFavorites="true"
                 favoritesLabel="&contextMoveCopyMsgFavoritesMenu.label;"
                 favoritesAccessKey="&contextMoveCopyMsgFavoritesMenu.accesskey;"
                 hasbeenopened="false" />
    </menu>

    <menu id="mailContext-calendar-convert-menu"
          class="menu-iconic hide-when-calendar-deactivated"
          label="&calendar.context.convertmenu.label;"
          accesskey="&calendar.context.convertmenu.accesskey.mail;">
      <menupopup id="mailContext-calendar-convert-menupopup">
        <menuitem id="mailContext-calendar-convert-event-menuitem"
                  label="&calendar.context.convertmenu.event.label;"
                  accesskey="&calendar.context.convertmenu.event.accesskey;"/>
        <menuitem id="mailContext-calendar-convert-task-menuitem"
                  label="&calendar.context.convertmenu.task.label;"
                  accesskey="&calendar.context.convertmenu.task.accesskey;"/>
      </menupopup>
    </menu>
    <menuitem id="mailContext-delete"
              class="menuitem-iconic"/>
    <menuseparator/>

    <!-- Threads -->
    <menuitem id="mailContext-ignoreThread"
              type="checkbox"
              label="&contextKillThreadMenu.label;"
              accesskey="&contextKillThreadMenu.accesskey;"/>
    <menuitem id="mailContext-ignoreSubthread"
              type="checkbox"
              label="&contextKillSubthreadMenu.label;"
              accesskey="&contextKillSubthreadMenu.accesskey;"/>
    <menuitem id="mailContext-watchThread"
              type="checkbox"
              label="&contextWatchThreadMenu.label;"
              accesskey="&contextWatchThreadMenu.accesskey;"/>
    <menuseparator/>

    <!-- Save/print/download -->
    <menuitem id="mailContext-saveAs"
              class="menuitem-iconic"
              label="&contextSaveAs.label;"
              accesskey="&contextSaveAs.accesskey;"/>
    <menuitem id="mailContext-print"
              class="menuitem-iconic"
              label="&contextPrint.label;"
              accesskey="&contextPrint.accesskey;"
              observes="cmd_print"/>
    <menuitem id="mailContext-downloadSelected"
              class="menuitem-iconic"
              label="&downloadSelectedCmd.label;"
              accesskey="&downloadSelectedCmd.accesskey;"/>
  </menupopup>

  <menupopup id="messageIdContext">
    <menuitem id="messageIdContext-messageIdTarget" disabled="true"/>
    <menuseparator id="messageIdContext-separator"/>
    <menuitem id="messageIdContext-openMessageForMsgId"
              label="&OpenMessageForMsgId.label;"
              accesskey="&OpenMessageForMsgId.accesskey;"
              oncommand="gMessageHeader.openMessage(event);"/>
    <menuitem id="messageIdContext-openBrowserWithMsgId"
              label="&OpenBrowserWithMsgId.label;"
              accesskey="&OpenBrowserWithMsgId.accesskey;"
              oncommand="gMessageHeader.openBrowser(event);"/>
    <menuitem id="messageIdContext-copyMessageId"
              label="&CopyMessageId.label;"
              accesskey="&CopyMessageId.accesskey;"
              oncommand="gMessageHeader.copyMessageId(event);"/>
  </menupopup>

  <menupopup id="attachmentItemContext"
             onpopupshowing="return onShowAttachmentItemContextMenu();"
             onpopuphiding="return onHideAttachmentItemContextMenu();">
    <menuitem id="context-openAttachment"
              label="&openAttachmentCmd.label;"
              accesskey="&openAttachmentCmd.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'open');"/>
    <menuitem id="context-saveAttachment"
              label="&saveAsAttachmentCmd.label;"
              accesskey="&saveAsAttachmentCmd.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'saveAs');"/>
    <menuseparator id="context-menu-separator"/>
    <menuitem id="context-detachAttachment"
              label="&detachAttachmentCmd.label;"
              accesskey="&detachAttachmentCmd.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'detach');"/>
    <menuitem id="context-deleteAttachment"
              label="&deleteAttachmentCmd.label;"
              accesskey="&deleteAttachmentCmd.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'delete');"/>
    <menuseparator id="context-menu-copyurl-separator"/>
    <menuitem id="context-copyAttachmentUrl"
              label="&copyLinkCmd.label;"
              accesskey="&copyLinkCmd.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'copyUrl');"/>
    <menuitem id="context-openFolder"
              label="&detachedAttachmentFolder.show.label;"
              accesskey="&detachedAttachmentFolder.show.accesskey;"
              oncommand="HandleMultipleAttachments(this.parentNode.attachments, 'openFolder');"/>

    <menuseparator id="openpgpCtxItemsSeparator"/>
    <menuitem id="enigmail_ctxImportKey"
              data-l10n-id="openpgp-ctx-import-key"
              oncommand="Enigmail.msg.handleAttachmentSel('importKey');"/>
    <menuitem id="enigmail_ctxDecryptOpen"
              data-l10n-id="openpgp-ctx-decrypt-open"
              oncommand="Enigmail.msg.handleAttachmentSel('openAttachment');"/>
    <menuitem id="enigmail_ctxDecryptSave"
              data-l10n-id="openpgp-ctx-decrypt-save"
              oncommand="Enigmail.msg.handleAttachmentSel('saveAttachment');"/>
    <menuitem id="enigmail_ctxVerifyAtt"
              data-l10n-id="openpgp-ctx-verify-att"
              oncommand="Enigmail.msg.handleAttachmentSel('verifySig');"/>
  </menupopup>

  <menupopup id="attachmentListContext"
             onpopupshowing="goUpdateAttachmentCommands();">
    <menuitem id="context-openAllAttachments"
              label="&openAllAttachmentsCmd.label;"
              accesskey="&openAllAttachmentsCmd.accesskey;"
              command="cmd_openAllAttachments"/>
    <menuitem id="context-saveAllAttachments"
              label="&saveAllAttachmentsCmd.label;"
              accesskey="&saveAllAttachmentsCmd.accesskey;"
              command="cmd_saveAllAttachments"/>
    <menuseparator id="context-menu-separator-all"/>
    <menuitem id="context-detachAllAttachments"
              label="&detachAllAttachmentsCmd.label;"
              accesskey="&detachAllAttachmentsCmd.accesskey;"
              command="cmd_detachAllAttachments"/>
    <menuitem id="context-deleteAllAttachments"
              label="&deleteAllAttachmentsCmd.label;"
              accesskey="&deleteAllAttachmentsCmd.accesskey;"
              command="cmd_deleteAllAttachments"/>
  </menupopup>

  <menupopup id="attachment-toolbar-context-menu"
             onpopupshowing="return onShowAttachmentToolbarContextMenu(event);">
    <menuitem id="context-expandAttachmentBar"
              type="checkbox"
              label="&startExpandedCmd.label;"
              accesskey="&startExpandedCmd.accesskey;"
              oncommand="Services.prefs.setBoolPref('mailnews.attachments.display.start_expanded', this.getAttribute('checked'));"/>
  </menupopup>

  <menupopup id="emailAddressPopup"
             position="after_start"
             class="no-icon-menupopup">
    <menuitem id="emailAddressPlaceHolder"
              class="menuitem-iconic"
              disabled="true"/>
    <menuseparator/>
    <menuitem id="addToAddressBookItem"
              label="&AddDirectlyToAddressBook.label;"
              accesskey="&AddDirectlyToAddressBook.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.addContact(event);"/>
    <menuitem id="editContactItem" label="&EditContact1.label;" hidden="true"
              accesskey="&EditContact1.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.showContactEdit(event);"/>
    <menuitem id="viewContactItem" label="&ViewContact.label;" hidden="true"
              accesskey="&ViewContact.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.showContactEdit(event);"/>
    <menuitem id="sendMailToItem" label="&SendMessageTo.label;"
              accesskey="&SendMessageTo.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.composeMessage(event);"/>
    <menuitem id="copyEmailAddressItem" label="&CopyEmailAddress.label;"
              accesskey="&CopyEmailAddress.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.copyAddress(event)"/>
    <menuitem id="copyNameAndEmailAddressItem" label="&CopyNameAndEmailAddress.label;"
              accesskey="&CopyNameAndEmailAddress.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.copyAddress(event, true);"/>
    <menuseparator/>
    <menuitem id="searchKeysOpenPGP" data-l10n-id="openpgp-search-keys-openpgp"
              class="menuitem-iconic"
              oncommand="Enigmail.msg.searchKeysOnInternet(event)"/>
    <menuseparator/>
    <menuitem id="createFilterFrom" label="&CreateFilterFrom.label;"
              accesskey="&CreateFilterFrom.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.createFilter(event);"/>
  </menupopup>

  <menupopup id="copyPopup" class="no-icon-menupopup">
    <menuitem id="copyMenuitem"
              data-l10n-id="text-action-copy"
              class="menuitem-iconic"
              oncommand="gMessageHeader.copyString(event);"/>
    <menuitem id="copyCreateFilterFrom"
              label="&CreateFilterFrom.label;"
              accesskey="&CreateFilterFrom.accesskey;"
              class="menuitem-iconic"
              oncommand="gMessageHeader.createFilter(event);"/>
  </menupopup>

  <menupopup id="copyUrlPopup"
             popupanchor="bottomleft">
    <menuitem label="&copyLinkCmd.label;"
              accesskey="&copyLinkCmd.accesskey;"
              oncommand="gMessageHeader.copyWebsiteUrl(event);"/>
  </menupopup>

  <menupopup id="simpleCopyPopup" class="no-icon-menupopup">
    <menuitem id="copyMenuitem"
              data-l10n-id="text-action-copy"
              class="menuitem-iconic"
              oncommand="gMessageHeader.copyString(event);"/>
  </menupopup>

  <menupopup id="newsgroupPopup"
             position="after_start"
             class="newsgroupPopup no-icon-menupopup">
      <menuitem id="newsgroupPlaceHolder"
                class="menuitem-iconic"
                disabled="true"/>
      <menuseparator/>
      <menuitem id="sendMessageToNewsgroupItem"
                label="&SendMessageTo.label;"
                accesskey="&SendMessageTo.accesskey;"
                class="menuitem-iconic"
                oncommand="gMessageHeader.composeMessage(event);"/>
      <menuitem id="copyNewsgroupNameItem"
                label="&CopyNewsgroupName.label;"
                accesskey="&CopyNewsgroupName.accesskey;"
                class="menuitem-iconic"
                oncommand="gMessageHeader.copyAddress(event);"/>
      <menuitem id="copyNewsgroupURLItem"
                label="&CopyNewsgroupURL.label;"
                accesskey="&CopyNewsgroupURL.accesskey;"
                class="menuitem-iconic"
                oncommand="gMessageHeader.copyNewsgroupURL(event);"/>
      <menuseparator id="subscribeToNewsgroupSeparator"/>
      <menuitem id="subscribeToNewsgroupItem"
                label="&SubscribeToNewsgroup.label;"
                accesskey="&SubscribeToNewsgroup.accesskey;"
                class="menuitem-iconic"
                oncommand="gMessageHeader.subscribeToNewsgroup(event)"/>
  </menupopup>

  <menupopup id="remoteContentOptions" value=""
             onpopupshowing="onRemoteContentOptionsShowing(event);">
    <menuitem id="remoteContentOptionAllowForMsg"
              label="&remoteContentOptionsAllowForMsg.label;"
              accesskey="&remoteContentOptionsAllowForMsg.accesskey;"
              oncommand="LoadMsgWithRemoteContent();"/>
    <menuseparator id="remoteContentSettingsMenuSeparator"/>
    <menuitem id="editRemoteContentSettings"
              label="&editRemoteContentSettings.label;"
              accesskey="&editRemoteContentSettings.accesskey;"
              oncommand="editRemoteContentSettings();"/>
    <menuseparator id="remoteContentOriginsMenuSeparator"/>
    <menuseparator id="remoteContentAllMenuSeparator"/>
    <menuitem id="remoteContentOptionAllowAll"
              oncommand="allowRemoteContentForAll(this.parentNode);"/>
  </menupopup>

  <menupopup id="phishingOptions">
    <menuitem id="phishingOptionIgnore"
              label="&phishingOptionIgnore.label;"
              accesskey="&phishingOptionIgnore.accesskey;"
              oncommand="IgnorePhishingWarning();"/>
    <menuitem id="phishingOptionSettings"
              label="&phishingOptionSettings.label;"
              accesskey="&phishingOptionSettings.accesskey;"
              oncommand="OpenPhishingSettings();"/>
  </menupopup>

<html:template id="editContactPanelTemplate">
<panel id="editContactPanel"
        type="arrow"
        orient="vertical"
        class="cui-widget-panel popup-panel panel-no-padding"
        ignorekeys="true"
        aria-labelledby="editContactPanelTitle"
        onpopuphidden="editContactInlineUI.onPopupHidden(event);"
        onpopupshown="editContactInlineUI.onPopupShown(event);"
        onkeypress="editContactInlineUI.onKeyPress(event, true);">
  <html:div class="popup-panel-body">
    <html:div id="editContactHeader">
      <html:img id="editContactPanelIcon"
                src="chrome://messenger/skin/icons/new/normal/address-book.svg"
                alt="" />
      <html:h3 id="editContactPanelTitle" flex="1"></html:h3>
    </html:div>

    <box id="editContactContent">
      <hbox pack="end">
        <label value="&editContactName.label;"
               class="editContactPanel_rowLabel"
               accesskey="&editContactName.accesskey;"
               control="editContactName"/>
      </hbox>
      <html:input id="editContactName" class="editContactTextbox" type="text"
                  onkeypress="editContactInlineUI.onKeyPress(event, true);"/>
      <hbox pack="end">
        <label value="&editContactEmail.label;"
               class="editContactPanel_rowLabel"
               accesskey="&editContactEmail.accesskey;"
               control="editContactEmail"/>
      </hbox>
      <html:input id="editContactEmail" readonly="readonly"
                  class="editContactTextbox" type="email"
                  onkeypress="editContactInlineUI.onKeyPress(event, true);"/>
      <hbox pack="end">
        <label id="editContactAddressBook"
               class="editContactPanel_rowLabel"
               value="&editContactAddressBook.label;"
               accesskey="&editContactAddressBook.accesskey;"
               control="editContactAddressBookList"/>
      </hbox>
      <menulist is="menulist-addrbooks"
                id="editContactAddressBookList"
                flex="1"/>
      <label value="" collapsed="true"/>
      <description id="contactMoveDisabledText" hidden="true">
        &contactMoveDisabledWarning.description;
      </description>
    </box>

    <html:div class="popup-panel-buttons-container">
      <button id="editContactPanelEditDetailsButton"
              oncommand="editContactInlineUI.editDetails();"
              onkeypress="editContactInlineUI.onKeyPress(event, false);"/>
      <button id="editContactPanelDeleteContactButton"
              label="&editContactPanelDeleteContact.label;"
              accesskey="&editContactPanelDeleteContact.accesskey;"
              oncommand="editContactInlineUI.deleteContact();"
              onkeypress="editContactInlineUI.onKeyPress(event, false);"/>
      <button id="editContactPanelDoneButton"
              class="primary"
              label="&editContactPanelDone.label;"
              accesskey="&editContactPanelDone.accesskey;"
              oncommand="editContactInlineUI.saveChanges();"
              onkeypress="editContactInlineUI.onKeyPress(event, false);"/>
    </html:div>
  </html:div>
</panel>
</html:template>
    <tooltip id="aHTMLTooltip" page="true"/>
  </popupset>

    <!-- msg header view -->
    <!-- a convenience box for ease of extension overlaying -->
    <hbox id="messagepaneboxwrapper" flex="1">
      <vbox id="messagepanebox">
        <vbox id="singleMessage">
          <hbox id="msgHeaderView" collapsed="true" class="main-header-area">

<menupopup id="header-toolbar-context-menu"
           onpopupshowing="ToolbarContextMenu.updateExtension(this);">
  <menuitem oncommand="ToolbarContextMenu.openAboutAddonsForContextAction(this.parentElement)"
            data-l10n-id="toolbar-context-menu-manage-extension"
            class="customize-context-manageExtension"/>
  <menuitem oncommand="ToolbarContextMenu.removeExtensionForContextAction(this.parentElement)"
            data-l10n-id="toolbar-context-menu-remove-extension"
            class="customize-context-removeExtension"/>
</menupopup>

<!-- Header container -->
<html:header id="messageHeader"
             class="message-header-container message-header-large-subject message-header-hide-label-column message-header-show-recipient-avatar message-header-show-sender-full-address">
  <!-- From + buttons -->
  <html:div id="headerSenderToolbarContainer"
            class="message-header-row header-row-reverse message-header-wrap items-center">
    <html:div id="header-view-toolbox" role="toolbar" class="header-buttons-container">
      <!-- NOTE: Temporarily keep the hbox to allow extensions to add custom sets of
        toolbar buttons. This can be later removed once a new API that doesn't rely
        on XUL currentset is in place. -->
      <hbox id="header-view-toolbar" class="header-buttons-container themeable-brighttext">
      <toolbarbutton id="hdrReplyToSenderButton" label="&hdrReplyButton1.label;"
                     tooltiptext="&hdrReplyButton2.tooltip;"
                     oncommand="MsgReplySender(event);"
                     class="toolbarbutton-1 message-header-view-button hdrReplyToSenderButton"/>

      <toolbaritem id="hdrSmartReplyButton" label="&hdrSmartReplyButton1.label;">
        <!-- This button is a dummy and should only be shown when customizing
              the toolbar to distinguish the smart reply button from the reply
              to sender button. -->
        <toolbarbutton id="hdrDummyReplyButton" label="&hdrSmartReplyButton1.label;"
                       hidden="true"
                       class="toolbarbutton-1 message-header-view-button hdrDummyReplyButton"/>

        <toolbarbutton id="hdrReplyButton" label="&hdrReplyButton1.label;"
                       tooltiptext="&hdrReplyButton2.tooltip;"
                       oncommand="MsgReplySender(event);"
                       class="toolbarbutton-1 message-header-view-button hdrReplyButton"/>

        <toolbarbutton is="toolbarbutton-menu-button" id="hdrReplyAllButton"
                       type="menu"
                       label="&hdrReplyAllButton1.label;"
                       tooltiptext="&hdrReplyAllButton1.tooltip;"
                       oncommand="MsgReplyToAllMessage(event);"
                       class="toolbarbutton-1 message-header-view-button hdrReplyButton hdrReplyAllButton"
                       hidden="true">
          <menupopup id="hdrReplyAllDropdown"
                     class="no-icon-menupopup">
            <menuitem id="hdrReplyAll_ReplyAllSubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyAllButton1.label;"
                      tooltiptext="&hdrReplyAllButton1.tooltip;"/>
            <toolbarseparator id="hdrReplyAllSubSeparator"/>
            <menuitem id="hdrReplySubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyButton1.label;"
                      tooltiptext="&hdrReplyButton2.tooltip;"
                      oncommand="MsgReplySender(event); event.stopPropagation();"/>
          </menupopup>
        </toolbarbutton>

        <toolbarbutton is="toolbarbutton-menu-button" id="hdrReplyListButton"
                       type="menu"
                       label="&hdrReplyListButton1.label;"
                       tooltiptext="&hdrReplyListButton1.tooltip;"
                       oncommand="MsgReplyToListMessage(event);"
                       class="toolbarbutton-1 message-header-view-button hdrReplyButton hdrReplyListButton"
                       hidden="true">
          <menupopup id="hdrReplyListDropdown"
                     class="no-icon-menupopup">
            <menuitem id="hdrReplyList_ReplyListSubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyListButton1.label;"
                      tooltiptext="&hdrReplyListButton1.tooltip;"/>
            <toolbarseparator id="hdrReplyListSubSeparator"/>
            <menuitem id="hdrRelplyList_ReplyAllSubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyAllButton1.label;"
                      tooltiptext="&hdrReplyAllButton1.tooltip;"
                      oncommand="MsgReplyToAllMessage(event); event.stopPropagation();"/>
            <menuitem id="hdrReplyList_ReplySubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyButton1.label;"
                      tooltiptext="&hdrReplyButton2.tooltip;"
                      oncommand="MsgReplySender(event); event.stopPropagation();"/>
          </menupopup>
        </toolbarbutton>

        <toolbarbutton is="toolbarbutton-menu-button" id="hdrFollowupButton"
                       label="&hdrFollowupButton1.label;"
                       type="menu"
                       tooltiptext="&hdrFollowupButton1.tooltip;"
                       oncommand="MsgReplyGroup(event);"
                       class="toolbarbutton-1 message-header-view-button hdrFollowupButton">
          <menupopup id="hdrFollowupDropdown"
                     class="no-icon-menupopup">
            <menuitem id="hdrFollowup_FollowupSubButton"
                      class="menuitem-iconic"
                      label="&hdrFollowupButton1.label;"
                      tooltiptext="&hdrFollowupButton1.tooltip;"/>
            <toolbarseparator id="hdrFollowupSubSeparator"/>
            <menuitem id="hdrFollowup_ReplyAllSubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyAllButton1.label;"
                      tooltiptext="&hdrReplyAllButton1.tooltip;"
                      oncommand="MsgReplyToAllMessage(event); event.stopPropagation();"/>
            <menuitem id="hdrFollowup_ReplySubButton"
                      class="menuitem-iconic"
                      label="&hdrReplyButton1.label;"
                      tooltiptext="&hdrReplyButton2.tooltip;"
                      oncommand="MsgReplySender(event); event.stopPropagation();"/>
          </menupopup>
        </toolbarbutton>
      </toolbaritem>

      <toolbarbutton id="hdrForwardButton"
                     label="&hdrForwardButton1.label;"
                     tooltiptext="&hdrForwardButton1.tooltip;"
                     oncommand="MsgForwardMessage(event);"
                     class="toolbarbutton-1 message-header-view-button hdrForwardButton"/>
      <toolbarbutton id="hdrArchiveButton"
                     label="&hdrArchiveButton1.label;"
                     tooltiptext="&hdrArchiveButton1.tooltip;"
                     oncommand="goDoCommand('cmd_archive');"
                     class="toolbarbutton-1 message-header-view-button hdrArchiveButton"/>
      <toolbarbutton id="hdrJunkButton" label="&hdrJunkButton1.label;"
                     tooltiptext="&hdrJunkButton1.tooltip;"
                     observes="cmd_markAsJunk"
                     class="toolbarbutton-1 message-header-view-button hdrJunkButton"
                     oncommand="goDoCommand('cmd_markAsJunk');"/>
      <toolbarbutton id="hdrTrashButton"
                     label="&hdrTrashButton1.label;"
                     tooltiptext="&hdrTrashButton1.tooltip;"
                     observes="cmd_delete"
                     class="toolbarbutton-1 message-header-view-button hdrTrashButton"
                     oncommand="goDoCommand(event.shiftKey ? 'cmd_shiftDelete' : 'cmd_delete');"/>
      <toolbarbutton id="otherActionsButton"
                     type="menu"
                     wantdropmarker="true"
                     label="&otherActionsButton2.label;"
                     tooltiptext="&otherActionsButton.tooltip;"
                     class="toolbarbutton-1 message-header-view-button">
        <menupopup id="otherActionsPopup"
                   class="no-icon-menupopup"
                   onpopupshowing="onShowOtherActionsPopup();">
          <menuitem id="otherActionsRedirect"
                    class="menuitem-iconic"
                    data-l10n-id="other-action-redirect-msg"
                    oncommand="MsgRedirectMessage();"/>
          <menuseparator id="otherActionsSeparator"/>
          <menu id="otherActionsTag"
                class="menu-iconic"
                label="&tagMenu.label;"
                accesskey="&tagMenu.accesskey;">
            <menupopup id="hdrTagDropdown"
                       onpopupshowing="window.top.InitMessageTags(this);">
              <menuitem id="hdrTagDropdown-addNewTag"
                        label="&addNewTag.label;"
                        accesskey="&addNewTag.accesskey;"
                        oncommand="goDoCommand('cmd_addTag');"/>
              <menuitem id="manageTags"
                        label="&manageTags.label;"
                        accesskey="&manageTags.accesskey;"
                        oncommand="goDoCommand('cmd_manageTags');"/>
              <menuseparator id="hdrTagDropdown-sep-afterAddNewTag"/>
              <menuitem id="hdrTagDropdown-tagRemoveAll"
                        oncommand="goDoCommand('cmd_removeTags');"/>
              <menuseparator id="hdrTagDropdown-sep-afterTagRemoveAll"/>
            </menupopup>
          </menu>
          <menuitem id="markAsReadMenuItem"
                    class="menuitem-iconic"
                    label="&markAsReadMenuItem1.label;"
                    accesskey="&markAsReadMenuItem1.accesskey;"
                    oncommand="MsgMarkMsgAsRead();"/>
          <menuitem id="markAsUnreadMenuItem"
                    class="menuitem-iconic"
                    label="&markAsUnreadMenuItem1.label;"
                    accesskey="&markAsUnreadMenuItem1.accesskey;"
                    oncommand="MsgMarkMsgAsRead();"/>
          <menuitem id="saveAsMenuItem"
                    class="menuitem-iconic"
                    label="&saveAsMenuItem1.label;"
                    accesskey="&saveAsMenuItem1.accesskey;"
                    oncommand="goDoCommand('cmd_saveAsFile')"/>
          <menuitem id="otherActionsPrint"
                    class="menuitem-iconic"
                    label="&otherActionsPrint1.label;"
                    accesskey="&otherActionsPrint1.accesskey;"
                    oncommand="goDoCommand('cmd_print');"/>
          <menu id="otherActions-calendar-convert-menu"
                class="menu-iconic"
                label="&calendar.context.convertmenu.label;"
                accesskey="&calendar.context.convertmenu.accesskey.mail;">
            <menupopup id="otherActions-calendar-convert-menupopup"
                       class="no-icon-menupopup">
              <menuitem id="otherActions-calendar-convert-event-menuitem"
                        class="menuitem-iconic"
                        label="&calendar.context.convertmenu.event.label;"
                        accesskey="&calendar.context.convertmenu.event.accesskey;"
                        oncommand="window.top.calendarExtract.extractFromEmail(true)"/>
              <menuitem id="otherActions-calendar-convert-task-menuitem"
                        class="menuitem-iconic"
                        label="&calendar.context.convertmenu.task.label;"
                        accesskey="&calendar.context.convertmenu.task.accesskey;"
                        oncommand="window.top.calendarExtract.extractFromEmail(false)"/>
            </menupopup>
          </menu>
          <menuseparator id="otherActionsComposeSeparator"/>
          <menuitem id="viewSourceMenuItem"
                    class="menuitem-iconic"
                    label="&viewSourceMenuItem1.label;"
                    accesskey="&viewSourceMenuItem1.accesskey;"
                    oncommand="goDoCommand('cmd_viewPageSource');"/>
          <menuitem id="charsetRepairMenuitem"
                    class="menuitem-iconic"
                    data-l10n-id="repair-text-encoding-button"
                    oncommand="MailSetCharacterSet()"/>
          <menu id="otherActionsMessageBodyAs"
                class="menu-iconic"
                label="&bodyMenu.label;">
            <menupopup id="hdrMessageBodyAsDropdown"
                       class="menu-iconic"
                       onpopupshowing="InitOtherActionsViewBodyMenu();">
              <menuitem id="otherActionsMenu_bodyAllowHTML"
                        class="menuitem-iconic"
                        type="radio"
                        name="bodyPlaintextVsHTMLPref"
                        label="&bodyAllowHTML.label;"
                        oncommand="top.MsgBodyAllowHTML()"/>
              <menuitem id="otherActionsMenu_bodySanitized"
                        class="menuitem-iconic"
                        type="radio"
                        name="bodyPlaintextVsHTMLPref"
                        label="&bodySanitized.label;"
                        oncommand="top.MsgBodySanitized()"/>
              <menuitem id="otherActionsMenu_bodyAsPlaintext"
                        class="menuitem-iconic"
                        type="radio"
                        name="bodyPlaintextVsHTMLPref"
                        label="&bodyAsPlaintext.label;"
                        oncommand="top.MsgBodyAsPlaintext()"/>
              <menuitem id="otherActionsMenu_bodyAllParts"
                        class="menuitem-iconic"
                        type="radio"
                        name="bodyPlaintextVsHTMLPref"
                        label="&bodyAllParts.label;"
                        oncommand="top.MsgBodyAllParts()"/>
            </menupopup>
          </menu>
          <menu id="otherActionsFeedBodyAs"
                class="menu-iconic"
                label="&bodyMenu.label;">
            <menupopup id="hdrFeedBodyAsDropdown"
                       class="menu-iconic"
                       onpopupshowing="InitOtherActionsViewBodyMenu();">
              <menuitem id="otherActionsMenu_bodyFeedGlobalWebPage"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedSummaryGroup"
                        label="&viewFeedWebPage.label;"
                        observes="bodyFeedGlobalWebPage"
                        oncommand="FeedMessageHandler.onSelectPref = 0"/>
              <menuitem id="otherActionsMenu_bodyFeedGlobalSummary"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedSummaryGroup"
                        label="&viewFeedSummary.label;"
                        observes="bodyFeedGlobalSummary"
                        oncommand="FeedMessageHandler.onSelectPref = 1"/>
              <menuitem id="otherActionsMenu_bodyFeedPerFolderPref"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedSummaryGroup"
                        label="&viewFeedSummaryFeedPropsPref.label;"
                        observes="bodyFeedPerFolderPref"
                        oncommand="FeedMessageHandler.onSelectPref = 2"/>
              <menuseparator id="otherActionsMenu_viewFeedSummarySeparator"/>
              <menuitem id="otherActionsMenu_bodyFeedSummaryAllowHTML"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedBodyHTMLGroup"
                        label="&bodyAllowHTML.label;"
                        oncommand="top.MsgFeedBodyRenderPrefs(false, 0, 0)"/>
              <menuitem id="otherActionsMenu_bodyFeedSummarySanitized"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedBodyHTMLGroup"
                        label="&bodySanitized.label;"
                        oncommand="top.MsgFeedBodyRenderPrefs(false, 3, gDisallow_classes_no_html)"/>
              <menuitem id="otherActionsMenu_bodyFeedSummaryAsPlaintext"
                        class="menuitem-iconic"
                        type="radio"
                        name="viewFeedBodyHTMLGroup"
                        label="&bodyAsPlaintext.label;"
                        oncommand="top.MsgFeedBodyRenderPrefs(true, 1, gDisallow_classes_no_html)"/>
            </menupopup>
          </menu>
          <menuseparator/>
          <menuitem id="messageHeaderMoreMenuCustomize"
                    class="menuitem-iconic"
                    data-l10n-id="menuitem-customize-label"
                    oncommand="gHeaderCustomize.showPanel()"/>
        </menupopup>
      </toolbarbutton>
      <html:button id="starMessageButton" role="checkbox" aria-checked="false"
                   class="plain-button email-action-button email-action-flagged"
                   data-l10n-id="message-header-msg-flagged">
        <html:img src="chrome://messenger/skin/icons/new/compact/star.svg" alt="" />
      </html:button>
      </hbox>
    </html:div>

    <html:div id="expandedfromRow" class="header-row-grow">
      <label id="expandedfromLabel" class="message-header-label header-pill-label"
             value="&fromField4.label;"
             valueFrom="&fromField4.label;" valueAuthor="&author.label;"/>
      <html:div id="expandedfromBox" is="multi-recipient-row"
                data-header-name="from" data-show-all="true"></html:div>
    </html:div>
  </html:div>

  <!-- To recipients + date -->
  <html:div id="expandedtoRow" class="message-header-row">
    <html:div class="header-row-grow">
      <label id="expandedtoLabel" class="message-header-label header-pill-label"
             value="&toField4.label;"/>
      <html:div id="expandedtoBox" is="multi-recipient-row"
                data-header-name="to"></html:div>
    </html:div>
    <html:time id="dateLabel"
               class="message-header-datetime"
               aria-readonly="true"></html:time>
  </html:div>

  <!-- Cc recipients -->
  <html:div id="expandedccRow" class="message-header-row" hidden="hidden">
    <label id="expandedccLabel" class="message-header-label header-pill-label"
           value="&ccField4.label;"/>
    <html:div id="expandedccBox" is="multi-recipient-row"
              data-header-name="cc"></html:div>
  </html:div>

  <!-- Bcc recipients -->
  <html:div id="expandedbccRow" class="message-header-row" hidden="hidden">
    <label id="expandedbccLabel" class="message-header-label header-pill-label"
           value="&bccField4.label;"/>
    <html:div id="expandedbccBox" is="multi-recipient-row"
              data-header-name="bcc"></html:div>
  </html:div>

  <!-- Reply-to -->
  <html:div id="expandedreply-toRow" class="message-header-row" hidden="hidden">
    <label id="expandedreply-toLabel" class="message-header-label header-pill-label"
           value="&replyToField4.label;"/>
    <html:div id="expandedreply-toBox" is="multi-recipient-row"
              data-header-name="reply-to"></html:div>
  </html:div>

  <!-- Organization -->
  <html:div id="expandedorganizationRow" class="message-header-row" hidden="hidden">
    <label id="expandedorganizationLabel" class="message-header-label"
           value="&organizationField4.label;"/>
    <html:div id="expandedorganizationBox" is="simple-header-row"
              data-header-name="organization"></html:div>
  </html:div>

  <!-- Sender -->
  <html:div id="expandedsenderRow" class="message-header-row" hidden="hidden">
    <label id="expandedsenderLabel" class="message-header-label header-pill-label"
           value="&senderField4.label;"/>
    <html:div id="expandedsenderBox" is="multi-recipient-row"
              data-header-name="sender"></html:div>
  </html:div>

  <!-- Newsgroups -->
  <html:div id="expandednewsgroupsRow" class="message-header-row" hidden="hidden">
    <label id="expandednewsgroupsLabel" class="message-header-label header-pill-label"
           value="&newsgroupsField4.label;"/>
    <html:div id="expandednewsgroupsBox" is="header-newsgroups-row"
              data-header-name="newsgroups"/>
  </html:div>

  <!-- Follow up -->
  <html:div id="expandedfollowup-toRow" class="message-header-row" hidden="hidden">
    <label id="expandedfollowup-toLabel" class="message-header-label header-pill-label"
           value="&followupToField4.label;"/>
    <html:div id="expandedfollowup-toBox"
              is="header-newsgroups-row"
              data-header-name="followup-to"/>
  </html:div>

  <!-- Subject + security info + extra date label for hidden To variation -->
  <html:div id="headerSubjectSecurityContainer" class="message-header-row">
     <html:div id="expandedsubjectRow" class="header-row-grow">
      <label id="expandedsubjectLabel" class="message-header-label"
             value="&subjectField4.label;"/>
      <html:div id="expandedsubjectBox" is="simple-header-row"
                data-header-name="subject"></html:div>
    </html:div>
    <html:div id="cryptoBox" hidden="hidden">
      <html:button id="encryptionTechBtn"
                   class="toolbarbutton-1 crypto-button themeable-brighttext button-focusable"
                   data-l10n-id="message-security-button">
        <html:span class="crypto-label"></html:span>
        <html:img id="encryptedHdrIcon" hidden="hidden" alt="" />
        <html:img id="signedHdrIcon" hidden="hidden" alt="" />
      </html:button>
    </html:div>
    <html:time id="dateLabelSubject"
               class="message-header-datetime"
               aria-readonly="true"
               hidden="hidden"></html:time>
  </html:div>

  <!-- Tags -->
  <html:div id="expandedtagsRow" class="message-header-row" hidden="hidden">
    <label id="expandedtagsLabel" class="message-header-label"
           value="&tagsHdr4.label;"/>
    <html:div id="expandedtagsBox" is="header-tags-row"
              data-header-name="tags"></html:div>
  </html:div>

  <!-- Date -->
  <html:div id="expandeddateRow" class="message-header-row" hidden="hidden">
    <label id="expandeddateLabel" class="message-header-label"
           value="&dateField4.label;"/>
    <html:div id="expandeddateBox" is="simple-header-row"
              data-header-name="date"></html:div>
  </html:div>

  <!-- Message ID -->
  <html:div id="expandedmessage-idRow" class="message-header-row" hidden="hidden">
    <label id="expandedmessage-idLabel" class="message-header-label header-pill-label"
           value="&messageIdField4.label;"/>
    <html:div id="expandedmessage-idBox" is="multi-message-ids-row"
              data-header-name="message-id"></html:div>
  </html:div>

  <!-- In reply to -->
  <html:div id="expandedin-reply-toRow" class="message-header-row" hidden="hidden">
    <label id="expandedin-reply-toLabel" class="message-header-label header-pill-label"
           value="&inReplyToField4.label;"/>
    <html:div id="expandedin-reply-toBox" is="multi-message-ids-row"
              data-header-name="in-reply-to"></html:div>
  </html:div>

  <!-- Reference -->
  <html:div id="expandedreferencesRow" class="message-header-row" hidden="hidden">
    <label id="expandedreferencesLabel" class="message-header-label header-pill-label"
           value="&referencesField4.label;"/>
    <html:div id="expandedreferencesBox" is="multi-message-ids-row"
              data-header-name="references"></html:div>
  </html:div>

  <!-- Content base -->
  <html:div id="expandedcontent-baseRow" class="message-header-row" hidden="hidden">
    <label id="expandedcontent-baseLabel" class="message-header-label"
           value="&originalWebsite4.label;"/>
    <html:div id="expandedcontent-baseBox" is="url-header-row"
              data-header-name="content-base"></html:div>
  </html:div>

  <!-- User agent -->
  <html:div id="expandeduser-agentRow" class="message-header-row" hidden="hidden">
    <label id="expandeduser-agentLabel" class="message-header-label"
           value="&userAgentField4.label;"/>
    <html:div id="expandeduser-agentBox" is="simple-header-row"
              data-header-name="user-agent"></html:div>
  </html:div>

  <!-- All extra headers will be dynamically added here. -->
  <html:div id="extraHeadersArea" class="message-header-extra-container"></html:div>

</html:header>
<!-- END Header container -->

<panel id="messageHeaderCustomizationPanel"
       type="arrow"
       orient="vertical"
       class="cui-widget-panel popup-panel panel-no-padding"
       onpopupshowing="gHeaderCustomize.onPanelShowing();"
       onpopuphidden="gHeaderCustomize.onPanelHidden();">
  <html:div class="popup-panel-body">
    <html:h3 data-l10n-id="message-header-customize-panel-title"></html:h3>

    <html:div class="popup-panel-options-grid">
      <label data-l10n-id="message-header-customize-button-style"
             control="headerButtonStyle"/>
      <menulist id="headerButtonStyle"
                oncommand="gHeaderCustomize.updateButtonStyle(event);"
                crop="none">
        <menupopup>
          <menuitem value="default" data-l10n-id="message-header-button-style-default"/>
          <menuitem value="only-text" data-l10n-id="message-header-button-style-text"/>
          <menuitem value="only-icons" data-l10n-id="message-header-button-style-icons"/>
        </menupopup>
      </menulist>

      <html:div class="popup-panel-column-container">
        <checkbox id="headerShowAvatar"
                  data-l10n-id="message-header-show-recipient-avatar"
                  oncommand="gHeaderCustomize.toggleAvatar(event);"/>

        <checkbox id="headerShowBigAvatar" class="indent"
                  data-l10n-id="message-header-show-big-avatar"
                  oncommand="gHeaderCustomize.toggleBigAvatar(event);"/>

        <checkbox id="headerShowFullAddress"
                  data-l10n-id="message-header-show-sender-full-address"
                  oncommand="gHeaderCustomize.toggleSenderAddress(event);"/>
        <html:span class="checkbox-description"
                   data-l10n-id="message-header-show-sender-full-address-description"></html:span>

        <checkbox id="headerHideLabels"
                  data-l10n-id="message-header-hide-label-column"
                  oncommand="gHeaderCustomize.toggleLabelColumn(event);"/>

        <checkbox id="headerSubjectLarge"
                  data-l10n-id="message-header-large-subject"
                  oncommand="gHeaderCustomize.updateSubjectStyle(event);"/>

        <checkbox id="headerViewAllHeaders"
                  data-l10n-id="message-header-all-headers"
                  oncommand="gHeaderCustomize.toggleAllHeaders(event);"/>
      </html:div>
    </html:div>

    <html:div class="popup-panel-buttons-container">
      <html:button type="button"
                   data-l10n-id="customize-panel-button-save"
                   onclick="gHeaderCustomize.closePanel()"
                   class="primary">
      </html:button>
    </html:div>
  </html:div>
</panel>
          </hbox>


        <hbox id="imip-bar"
              class="calendar-notification-bar"
              collapsed="true"
              label="&lightning.imipbar.description;"
              align="center">
          <html:img src="chrome://messenger/skin/icons/new/normal/calendar-invite.svg"
                    alt="" />
          <description class="msgNotificationBarText"
                       flex="1">
            &lightning.imipbar.description;
          </description>

          <!-- Some Toolbox implementation notes:
             -
             - css style:
             - classes within toolbox are making use of existing TB css definitions - as used in
             - /comm-central/source/mail/base/content/msgHdrView.inc, only icon defining
             - classes like imipAcceptButton are noted separately and OS specific within
             - skin/calendar.css (resp. the OS-specific theme folders)
             -
             - The toolbarbuttons will be adjusted dynamically in imip-bar.js based on their
             - content of menuitems. To avoid breaking this, the following should be considered
             - if adding/changing toolbarbutton definitions.
             - general:
             -    * the toolbarbuttons will appear in order of definition
             -      within the toolbar if visible
             -    * must be hidden by default
             -    * menuitem inside must not be hidden by default
             - simple button:
             -    * must not have a type attribute
             -    * may have menupopup/menuitem within (not displayed though)
             - dropdown only:
             -    * must have type=menu
             -    * should have a menupopup with at least one menuitem
             - smart-dropdown (toolbarbutton-menu-button)
             -    * must have type=menu
             -    * should have a menupopup with at least one menuitem
             //-->
          <vbox id="imip-view-toolbox" class="inline-toolbox">
            <hbox id="imip-view-toolbar" class="themeable-brighttext">

              <!-- show event/invitation details -->
              <toolbarbutton id="imipDetailsButton"
                             label="&lightning.imipbar.btnDetails.label;"
                             tooltiptext="&lightning.imipbar.btnDetails.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipDetailsButton"
                             oncommand="calImipBar.executeAction('X-SHOWDETAILS')"
                             hidden="true"/>

              <!-- decline counter -->
              <toolbarbutton id="imipDeclineCounterButton"
                             label="&lightning.imipbar.btnDeclineCounter.label;"
                             tooltiptext="&lightning.imipbar.btnDeclineCounter.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipDeclineCounterButton"
                             oncommand="calImipBar.executeAction('X-DECLINECOUNTER')"
                             hidden="true"/>

              <!-- reschedule -->
              <toolbarbutton id="imipRescheduleButton"
                             label="&lightning.imipbar.btnReschedule.label;"
                             tooltiptext="&lightning.imipbar.btnReschedule.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipRescheduleButton"
                             oncommand="calImipBar.executeAction('X-RESCHEDULE')"
                             hidden="true"/>

              <!-- add published events -->
              <toolbarbutton id="imipAddButton"
                             label="&lightning.imipbar.btnAdd.label;"
                             tooltiptext="&lightning.imipbar.btnAdd.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipAddButton"
                             oncommand="calImipBar.executeAction()"
                             hidden="true"/>

              <!-- update published events and invitations -->
              <toolbarbutton id="imipUpdateButton"
                             label="&lightning.imipbar.btnUpdate.label;"
                             tooltiptext="&lightning.imipbar.btnUpdate.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipUpdateButton"
                             oncommand="calImipBar.executeAction()"
                             hidden="true"/>

              <!-- delete cancelled events from calendar -->
              <toolbarbutton id="imipDeleteButton"
                             label="&lightning.imipbar.btnDelete.label;"
                             tooltiptext="&lightning.imipbar.btnDelete.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipDeleteButton"
                             oncommand="calImipBar.executeAction()"
                             hidden="true"/>

              <!-- re-confirm partstat -->
              <toolbarbutton id="imipReconfirmButton"
                             label="&lightning.imipbar.btnReconfirm2.label;"
                             tooltiptext="&lightning.imipbar.btnReconfirm.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipReconfirmButton"
                             oncommand="calImipBar.executeAction()"
                             hidden="true"/>

              <!-- go to calendar tab -->
              <toolbarbutton id="imipGoToCalendarButton"
                             label="&lightning.imipbar.btnGoToCalendar.label;"
                             tooltiptext="&lightning.imipbar.btnGoToCalendar.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipGoToCalendarButton"
                             oncommand="calImipBar.goToCalendar();"
                             hidden="true"/>

              <!-- accept -->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipAcceptButton"
                             tooltiptext="&lightning.imipbar.btnAccept2.tooltiptext;"
                             label="&lightning.imipbar.btnAccept.label;"
                             oncommand="calImipBar.executeAction('ACCEPTED', 'AUTO');"
                             type="menu"
                             class="imip-button toolbarbutton-1 message-header-view-button imipAcceptButton"
                             hidden="true">
                <menupopup id="imipAcceptDropdown">
                  <label id="imipAcceptButton_AcceptLabel"
                         class="imipAcceptLabel"
                         tooltiptext="&lightning.imipbar.btnAccept2.tooltiptext;"
                         value="&lightning.imipbar.btnAccept.label;"/>
                  <menuitem id="imipAcceptButton_Accept"
                            tooltiptext="&lightning.imipbar.btnSend.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('ACCEPTED', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipAcceptButton_AcceptDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSend.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('ACCEPTED', 'NONE'); event.stopPropagation();"/>
                  <separatpor flex="1" class="groove"/>
                  <label id="imipAcceptButton_TentativeLabel"
                         class="imipAcceptLabel"
                         tooltiptext="&lightning.imipbar.btnTentative2.tooltiptext;"
                         value="&lightning.imipbar.btnTentative.label;"/>
                  <menuitem id="imipAcceptButton_Tentative"
                            tooltiptext="&lightning.imipbar.btnSend.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipAcceptButton_TentativeDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSend.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- accept recurrences -->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipAcceptRecurrencesButton"
                             tooltiptext="&lightning.imipbar.btnAcceptRecurrences2.tooltiptext;"
                             label="&lightning.imipbar.btnAcceptRecurrences.label;"
                             oncommand="calImipBar.executeAction('ACCEPTED', 'AUTO');"
                             type="menu"
                             class="imip-button toolbarbutton-1 message-header-view-button imipAcceptRecurrencesButton"
                             hidden="true">
                <menupopup id="imipAcceptRecurrencesDropdown">
                  <label id="imipAcceptRecurrencesButton_AcceptLabel"
                         class="imipAcceptLabel"
                         tooltiptext="&lightning.imipbar.btnAcceptRecurrences2.tooltiptext;"
                         value="&lightning.imipbar.btnAcceptRecurrences.label;"/>
                  <menuitem id="imipAcceptRecurrencesButton_Accept"
                            tooltiptext="&lightning.imipbar.btnSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('ACCEPTED', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipAcceptRecurrencesButton_AcceptDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('ACCEPTED', 'NONE'); event.stopPropagation();"/>
                  <separatpor flex="1" class="groove"/>
                  <label id="imipAcceptRecurrencesButton_TentativeLabel"
                         class="imipAcceptLabel"
                         tooltiptext="&lightning.imipbar.btnTentativeRecurrences2.tooltiptext;"
                         value="&lightning.imipbar.btnTentativeRecurrences.label;"/>
                  <menuitem id="imipAcceptRecurrencesButton_Tentative"
                            tooltiptext="&lightning.imipbar.btnSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipAcceptRecurrencesButton_TentativeDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- tentative; should only be used, if no imipMoreButton is used and
                 - imipDeclineButton/imipAcceptButton have no visible menuitems //-->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipTentativeButton"
                             label="&lightning.imipbar.btnTentative.label;"
                             tooltiptext="&lightning.imipbar.btnTentative2.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipTentativeButton"
                             oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO');"
                             type="menu"
                             hidden="true">
                <menupopup id="imipTentativeDropdown">
                  <menuitem id="imipTentativeButton_Tentative"
                            tooltiptext="&lightning.imipbar.btnSend.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipTentativeButton_TentativeDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSend.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- tentative recurrences; should only be used, if no imipMoreButton is used and
                 - imipDeclineRecurrencesButton/imipAcceptRecurrencesButton have no visible menuitems //-->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipTentativeRecurrencesButton"
                             label="&lightning.imipbar.btnTentativeRecurrences.label;"
                             tooltiptext="&lightning.imipbar.btnTentativeRecurrences2.tooltiptext;"
                             class="toolbarbutton-1 message-header-view-button imipTentativeRecurrencesButton"
                             oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO');"
                             type="menu"
                             hidden="true">
                <menupopup id="imipTentativeRecurrencesDropdown">
                  <menuitem id="imipTentativeRecurrencesButton_Tentative"
                            tooltiptext="&lightning.imipbar.btnSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipTentativeRecurrencesButton_TentativeDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('TENTATIVE', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- decline -->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipDeclineButton"
                             tooltiptext="&lightning.imipbar.btnDecline2.tooltiptext;"
                             label="&lightning.imipbar.btnDecline.label;"
                             oncommand="calImipBar.executeAction('DECLINED', 'AUTO');"
                             type="menu"
                             class="toolbarbutton-1 message-header-view-button imipDeclineButton"
                             hidden="true">
                <menupopup id="imipDeclineDropdown">
                  <menuitem id="imipDeclineButton_Decline"
                            tooltiptext="&lightning.imipbar.btnSend.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('DECLINED', 'AUTO'); event.stopPropagation();"/>
                  <menuitem id="imipDeclineButton_DeclineDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSend.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('DECLINED', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- decline recurrences -->
              <toolbarbutton is="toolbarbutton-menu-button" id="imipDeclineRecurrencesButton"
                             tooltiptext="&lightning.imipbar.btnDeclineRecurrences2.tooltiptext;"
                             label="&lightning.imipbar.btnDeclineRecurrences.label;"
                             oncommand="calImipBar.executeAction('DECLINED', 'AUTO');"
                             type="menu"
                             class="toolbarbutton-1 message-header-view-button imipDeclineRecurrencesButton"
                             hidden="true">
                <menupopup id="imipDeclineRecurrencesDropdown">
                  <menuitem id="imipDeclineRecurrencesButton_DeclineAll"
                            tooltiptext="&lightning.imipbar.btnSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnSend.label;"
                            oncommand="calImipBar.executeAction('DECLINED'); event.stopPropagation();"/>
                  <menuitem id="imipDeclineRecurrencesButton_DeclineDontSend"
                            tooltiptext="&lightning.imipbar.btnDontSendSeries.tooltiptext;"
                            label="&lightning.imipbar.btnDontSend.label;"
                            oncommand="calImipBar.executeAction('DECLINED', 'NONE'); event.stopPropagation();"/>
                  <!-- add here more menuitem as needed -->
                </menupopup>
              </toolbarbutton>

              <!-- more options -->
              <toolbarbutton id="imipMoreButton"
                             type="menu"
                             wantdropmarker="true"
                             tooltiptext="&lightning.imipbar.btnMore.tooltiptext;"
                             label="&lightning.imipbar.btnMore.label;"
                             class="toolbarbutton-1 message-header-view-button imipMoreButton"
                             hidden="true">
                <menupopup id="imipMoreDropdown">
                  <menuitem id="imipMoreButton_SaveCopy"
                            tooltiptext="&lightning.imipbar.btnSaveCopy.tooltiptext;"
                            label="&lightning.imipbar.btnSaveCopy.label;"
                            oncommand="calImipBar.executeAction('X-SAVECOPY'); event.stopPropagation();"/>
                  <menuitem id="imipMoreButton_DoNotShowImipBar"
                            label="&lightning.imipbar.btnDoNotShowImipBar.label;"
                            oncommand="calImipBar.doNotShowImipBar();"/>
                  <!-- add here a menuitem as needed -->
                </menupopup>
              </toolbarbutton>
            </hbox>
          </vbox>
        </hbox>
        </vbox>
        <!-- The msgNotificationBar appears on top of the message and displays
             information like: junk, mdn, remote content and phishing warnings -->
        <vbox id="mail-notification-top">
          <!-- notificationbox will be added here lazily. -->
        </vbox>


<!-- Template for <calendar-invitation-panel/> -->
<template id="calendarInvitationPanel" xmlns="http://www.w3.org/1999/xhtml">
  <calendar-invitation-panel-status-bar/>
  <div class="calendar-invitation-panel-wrapper">
    <div class="calendar-invitation-panel-preview">
      <calendar-minidate/>
    </div>
    <div class="calendar-invitation-panel-details">
      <div class="calendar-invitation-panel-title">
        <calendar-invitation-change-indicator id="titleChangeIndicator"
                                              hidden="hidden"/>
        <h1 class="calendar-invitation-panel-title" id="title"></h1>
      </div>
       <table id="props" class="calendar-invitation-panel-props">
         <tbody>
           <tr class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-when"></th>
             <td class="calendar-invitation-when">
               <calendar-invitation-change-indicator id="intervalChangeIndicator"
                                                     hidden="hidden"/>
               <calendar-invitation-interval id="when"/>
             </td>
           </tr>
           <tr hidden="hidden" class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-recurrence"></th>
             <td id="recurrence" class="calendar-invitation-recurrence">
               <calendar-invitation-change-indicator id="recurrenceChangeIndicator"
                                                     hidden="hidden"/>
             </td>
           </tr>
           <tr hidden="hidden" class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-location"></th>
             <td id="location" class="content">
               <calendar-invitation-change-indicator id="locationChangeIndicator"
                                                     hidden="hidden"/>
             </td>
           </tr>
           <tr hidden="hidden" class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-attendees"></th>
             <td>
               <calendar-invitation-partstat-summary id="summary"/>
               <ul id="attendees"
                   is="calendar-invitation-panel-attendee-list"
                   class="calendar-invitation-panel-list"></ul>
             </td>
           </tr>
           <tr hidden="hidden" class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-description"></th>
             <td id="description" class="content">
               <calendar-invitation-change-indicator id="descriptionChangeIndicator"
                                                     hidden="hidden"/>
             </td>
           </tr>
           <tr hidden="hidden" class="calendar-invitation-row">
             <th data-l10n-id="calendar-invitation-panel-prop-title-attachments"></th>
             <td class="content">
               <ul id="attachments"
                   is="calendar-invitation-panel-attachment-list"
                   class="calendar-invitation-panel-list"></ul>
             </td>
           </tr>
         </tbody>
       </table>
    </div>
  </div>
  <div id="footer" class="calendar-invitation-panel-details-footer" hidden="hidden">
    <div id="actionButtons" class="calendar-invitation-panel-response-buttons">
      <button id="acceptButton"
              data-action="accepted"
              class="primary"
              data-l10n-id="calendar-invitation-panel-accept-button"></button>
      <button id="declineButton"
              data-action="declined"
              data-l10n-id="calendar-invitation-panel-decline-button"></button>
      <button id="tentativeButton"
              data-action="tentative"
              data-l10n-id="calendar-invitation-panel-tentative-button"></button>
      </div>
    </div>
</template>

<!-- Template for <calendar-invitation-partstat-summary/> -->
<template id="calendarInvitationPartStatSummary" xmlns="http://www.w3.org/1999/xhtml">
  <div class="calendar-invitation-attendees-summary">
    <span id="partStatTotal"
          class="calendar-invitation-panel-partstat-summary-total"></span>
    <span id="partStatBreakdown" class="calendar-invitation-panel-partstat-breakdown"></span>
  </div>
</template>

<!-- Menu for the "More" button in the invitation panel. Populated via JavaScript.-->
<menupopup id="calendarInvitationPanelMoreMenu"></menupopup>

<!-- Template for <calendar-minidate /> -->
<template id="calendarMinidate" xmlns="http://www.w3.org/1999/xhtml">
  <div class="calendar-minidate-wrapper">
    <link rel="stylesheet" href="chrome://calendar/skin/shared/widgets/calendar-minidate.css"/>
    <div class="calendar-minidate-header">
      <span class="calendar-minidate-month"></span>
    </div>
    <div class="calendar-minidate-body">
      <span class="calendar-minidate-day"></span>
      <span class="calendar-minidate-year"></span>
    </div>
  </div>
</template>

        <vbox id="calendarInvitationDisplayContainer"
              flex="1"
              hidden="true">
          <html:div id="calendarInvitationDisplay">
           <!-- The calendar invitation panel is displayed here. -->
          </html:div>
        </vbox>

        <!-- message view -->
        <browser id="messagepane"
                 context="mailContext"
                 tooltip="aHTMLTooltip"
                 style="height: 0px; min-height: 1px; background-color: field;"
                 flex="1"
                 name="messagepane"
                 disablesecurity="true"
                 disablehistory="true"
                 type="content"
                 primary="true"
                 autofind="false"
                 nodefaultsrc="true"
                 forcemessagemanager="true"
                 maychangeremoteness="true"
                 messagemanagergroup="single-page"
                 onclick="return contentAreaClick(event);"
                 onresize="messagePaneOnResize();"/>
        <splitter id="attachment-splitter" orient="vertical"
                  resizebefore="closest" resizeafter="closest"
                  collapse="after" collapsed="true"/>
        <vbox id="attachmentView" collapsed="true">

                          <!-- the message pane consists of 4 'boxes'. Box #4 is the attachment
                               box which can be toggled into a slim or an expanded view -->
                          <hbox align="center" id="attachmentBar"
                                context="attachment-toolbar-context-menu"
                                onclick="if (event.button == 0) { toggleAttachmentList(undefined, true); }">
                            <button type="checkbox" id="attachmentToggle"
                                    onmousedown="event.preventDefault();"
                                    onclick="event.stopPropagation();"
                                    oncommand="toggleAttachmentList(this.checked, true);"/>
                            <hbox align="center" id="attachmentInfo" flex="1">
                              <html:img id="attachmentIcon"
                                        src="chrome://messenger/skin/icons/attach.svg"
                                        alt="" />
                              <label id="attachmentCount"/>
                              <label id="attachmentName" crop="center" flex="1"
                                     role="button"
                                     tooltiptext="&openAttachment.tooltip;"
                                     tooltiptextopen="&openAttachment.tooltip;"
                                     onclick="OpenAttachmentFromBar(event);"
                                     ondragstart="attachmentNameDNDObserver.onDragStart(event);"/>
                              <label id="attachmentSize"/>
                            </hbox>
                            <!-- Use a very large flex value here so that attachmentCount doesn't take
                                 up more space than necessary, but still crops itself if there's not
                                 enough space. -->
                            <spacer style="flex: 9999 9999;"/>

                            <vbox id="attachment-view-toolbox" class="inline-toolbox">
                              <hbox id="attachment-view-toolbar"
                                    class="toolbar themeable-brighttext"
                                    context="attachment-toolbar-context-menu">
                                <toolbaritem id="attachmentSaveAll"
                                             title="&saveAllAttachmentsButton1.label;">
                                  <toolbarbutton is="toolbarbutton-menu-button" id="attachmentSaveAllSingle"
                                                 type="menu"
                                                 class="toolbarbutton-1 message-header-view-button"
                                                 label="&saveAttachmentButton1.label;"
                                                 tooltiptext="&saveAttachmentButton1.tooltip;"
                                                 onclick="event.stopPropagation();"
                                                 oncommand="TryHandleAllAttachments('saveAs');"
                                                 hidden="true">
                                    <menupopup id="attachmentSaveAllSingleMenu"
                                               onpopupshowing="onShowSaveAttachmentMenuSingle();">
                                      <menuitem id="button-openAttachment"
                                                oncommand="TryHandleAllAttachments('open'); event.stopPropagation();"
                                                label="&openAttachmentCmd.label;"
                                                accesskey="&openAttachmentCmd.accesskey;"/>
                                      <menuitem id="button-saveAttachment"
                                                oncommand="TryHandleAllAttachments('saveAs'); event.stopPropagation();"
                                                label="&saveAsAttachmentCmd.label;"
                                                accesskey="&saveAsAttachmentCmd.accesskey;"/>
                                      <menuseparator id="button-menu-separator"/>
                                      <menuitem id="button-detachAttachment"
                                                oncommand="TryHandleAllAttachments('detach'); event.stopPropagation();"
                                                label="&detachAttachmentCmd.label;"
                                                accesskey="&detachAttachmentCmd.accesskey;"/>
                                      <menuitem id="button-deleteAttachment"
                                                oncommand="TryHandleAllAttachments('delete'); event.stopPropagation();"
                                                label="&deleteAttachmentCmd.label;"
                                                accesskey="&deleteAttachmentCmd.accesskey;"/>
                                    </menupopup>
                                  </toolbarbutton>
                                  <toolbarbutton is="toolbarbutton-menu-button" id="attachmentSaveAllMultiple"
                                                 type="menu"
                                                 class="toolbarbutton-1 message-header-view-button"
                                                 label="&saveAllAttachmentsButton1.label;"
                                                 tooltiptext="&saveAllAttachmentsButton1.tooltip;"
                                                 onclick="event.stopPropagation();"
                                                 oncommand="TryHandleAllAttachments('save');">
                                    <menupopup id="attachmentSaveAllMultipleMenu"
                                               onpopupshowing="onShowSaveAttachmentMenuMultiple();">
                                      <menuitem id="button-openAllAttachments"
                                                oncommand="TryHandleAllAttachments('open'); event.stopPropagation();"
                                                label="&openAllAttachmentsCmd.label;"
                                                accesskey="&openAllAttachmentsCmd.accesskey;"/>
                                      <menuitem id="button-saveAllAttachments"
                                                oncommand="TryHandleAllAttachments('save'); event.stopPropagation();"
                                                label="&saveAllAttachmentsCmd.label;"
                                                accesskey="&saveAllAttachmentsCmd.accesskey;"/>
                                      <menuseparator id="button-menu-separator-all"/>
                                      <menuitem id="button-detachAllAttachments"
                                                oncommand="TryHandleAllAttachments('detach'); event.stopPropagation();"
                                                label="&detachAllAttachmentsCmd.label;"
                                                accesskey="&detachAllAttachmentsCmd.accesskey;"/>
                                      <menuitem id="button-deleteAllAttachments"
                                                oncommand="TryHandleAllAttachments('delete'); event.stopPropagation();"
                                                label="&deleteAllAttachmentsCmd.label;"
                                                accesskey="&deleteAllAttachmentsCmd.accesskey;"/>
                                    </menupopup>
                                  </toolbarbutton>
                                </toolbaritem>
                              </hbox>
                            </vbox>
                          </hbox>
                          <richlistbox is="attachment-list" id="attachmentList"
                                       class="attachmentList"
                                       seltype="multiple"
                                       context="attachmentListContext"
                                       itemcontext="attachmentItemContext"
                                       role="listbox"
                                       ondragstart="attachmentListDNDObserver.onDragStart(event);"/>
        </vbox>
        <findbar id="FindToolbar" browserid="messagepane"/>
      </vbox>
  <panel id="messageSecurityPanel"
         type="arrow"
         orient="vertical"
         class="cui-widget-panel"
         position="bottomright topright"
         tabindex="-1">
    <vbox class="security-panel-body">
      <html:header class="message-security-header">
        <html:h3>&status.label; <html:span id="techLabel"></html:span></html:h3>
      </html:header>

      <vbox class="message-security-body">
        <!-- Notification container -->
        <vbox>
          <!-- Import OpenPGP key -->
          <hbox id="openpgpKeyBox" hidden="true"
                class="inline-notification-container info-container">
            <hbox class="inline-notification-wrapper align-center">
              <html:img class="notification-image"
                        src="chrome://messenger/skin/icons/information.svg"
                        alt="" />
              <description>
                <html:span data-l10n-id="openpgp-has-sender-key"></html:span>
              </description>
              <button id="openpgpImportButton"
                      class="button-focusable"
                      data-l10n-id="openpgp-import-sender-key"
                      oncommand="Enigmail.msg.importAttachedSenderKey();"/>
            </hbox>
          </hbox>

          <!-- Missing signature -->
          <hbox id="signatureKeyBox" hidden="true"
                class="inline-notification-container info-container">
            <hbox class="inline-notification-wrapper align-center">
              <html:img class="notification-image"
                        src="chrome://messenger/skin/icons/information.svg"
                        alt="" />
              <description data-l10n-id="openpgp-missing-signature-key"/>
              <button data-l10n-id="openpgp-search-signature-key"
                      class="button-focusable"
                      oncommand="Enigmail.msg.searchSignatureKey();"/>
            </hbox>
          </hbox>
        </vbox>

        <label id="signatureLabel" class="message-security-label"/>
        <label id="signatureHeader" collapsed="true" />
        <description id="signatureExplanation"/>

        <vbox id="signatureCert" class="message-security-container"
              collapsed="true">
          <hbox>
            <label id="signedByLabel" class="cert-label">&signer.name;</label>
            <description id="signedBy" />
          </hbox>
          <hbox>
            <label id="signerEmailLabel"
                   class="cert-label">&email.address;</label>
            <description id="signerEmail" />
          </hbox>
          <hbox>
            <label id="sigCertIssuedByLabel"
                   class="cert-label">&issuer.name;</label>
            <description id="sigCertIssuedBy" />
          </hbox>
          <hbox pack="end">
            <button id="signatureCertView" label="&signatureCert.label;"
                    class="button-focusable"
                    oncommand="viewSignatureCert()" />
          </hbox>
        </vbox>

        <hbox id="signatureKey" class="message-security-container"
              collapsed="true" align="center">
          <label id="signatureKeyId" flex="1" context="simpleCopyPopup"/>
          <button id="viewSignatureKey" data-l10n-id="openpgp-view-signer-key"
                  class="button-focusable"
                  oncommand="viewSignatureKey()" collapsed="true"/>
        </hbox>

        <label id="encryptionLabel" class="message-security-label"/>
        <label id="encryptionHeader" collapsed="true" />
        <description id="encryptionExplanation"/>

        <vbox id="encryptionCert" class="message-security-container"
              collapsed="true">
          <hbox>
            <label id="encryptedForLabel"
                   class="cert-label">&recipient.name;</label>
            <description id="encryptedFor" />
          </hbox>
          <hbox>
            <label id="recipientEmailLabel"
                   class="cert-label">&email.address;</label>
            <description id="recipientEmail" />
          </hbox>
          <hbox>
            <label id="encCertIssuedByLabel"
                   class="cert-label">&issuer.name;</label>
            <description id="encCertIssuedBy" />
          </hbox>
          <hbox pack="end">
            <button id="encryptionCertView" label="&encryptionCert.label;"
                    class="button-focusable"
                    oncommand="viewEncryptionCert()" />
          </hbox>
        </vbox>

        <vbox id="encryptionKey" class="message-security-container"
              collapsed="true">
          <label id="encryptionKeyId" context="simpleCopyPopup"/>
          <hbox pack="end">
            <button id="viewEncryptionKey"
                    data-l10n-id="openpgp-view-your-encryption-key"
                    class="button-focusable"
                    oncommand="viewEncryptionKey()"
                    collapsed="true"/>
          </hbox>
        </vbox>

        <vbox id="otherEncryptionKeys" collapsed="true">
          <label id="otherLabel" class="message-security-label none"/>
          <vbox id="otherEncryptionKeysList"/>
        </vbox>
      </vbox>
    </vbox>
  </panel>
    </hbox>
</html:body>
</html>
